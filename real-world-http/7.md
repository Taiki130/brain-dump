## HTTP/2 HTTP/3で変わらないこと
- 1.1はtextベースのプロトコル、2からはバイナリベース
- HTTP/3は通信の暗号化が必須、HTTP/2は多くのサーバーでTLS有効化していないと使えない
- マイクロサービス間の通信はまだ1.1
    - とはいえ、KeepAliveなどしていればローカルネットワークでは通信の速度にそこまで違いはない

## HTTP/2
- パフォーマンスにフォーカスされている
- バイナリ

### SPDY
- googleが作ったプロトコル
- http2の前身

### HTTP/2の改善点
- ストリームによる通信の高速化
- サーバー側から通信を開始するサーバーサイドプッシュ
- ストリームでの優先順位付け

### ストリームによる通信の高速化
- 各データはフレームと呼ばれる単位に分割される
- http1.1は一つのリクエストが一つのTCPソケットを占領するため
- TCPのコネクションで、仮想的なTCPソケットを作って並列化

### HTTP/2のアプリケーション層
### フローコントロール
- フローコントロールで、処理の速い機器が処理の遅い機器に送信するときに、処理できないなどの状況を防ぐ

### サーバープッシュ
- CSSやjavascriptなどのウェブサイトを構成する要素を、リクエストされる前にサーバー側からクライアント側に送信する
- クライアント側はそれをキャッシュして、リクエストされたらすぐに表示
- チャットなどwebsoketの双方向通信とは異なる

### HTTP/2とプリロードによるリソース取得の最適化
- 効果的にダウンロードできる仕組みが色々ある
    - サーバープッシュ
    - 優先度
    - プリロード

### HPACKによるヘッダーの圧縮
- HPACKは事前に定義済みの辞書（静的テーブル）を持っている

## HTTP/3
- QUICがHTTP/3になっていった

### QUIC
- UDPソケット上に用意した
- TCPが持っている機能を自前で用意
    - 再送処理
    - 輻輳制御
- TLSの機能もある

### HTTP/3への道
- IETF版のiQUICをHTTP/3とする

### HTTP/3のレイヤー
- IETF版のiQUIC
    - TCPの上位互換レイヤーとTLS1.3 -> QUICトランスポート
    - HTTP over QUIC
        - これをHTTP/3と呼ぶ 

### QUICトランスポートプロトコル
- コネクションを識別するのがコネクションIDだけ
    - 21世紀のインターネットに適応するように作られていて、wifiや4G, 5Gなどの別の通信経路でもことなるコネクションとして識別されないようになっている
- TLSを使わないプロトコルが定義されてない
- WebRTC方面で活発

### HTTP Alternative Servicesによるアップグレード
### HTTP/3
- HTTP/2と比較すると、シンプルになった
    - QUICトランスポートとHTTP/3に分かれたため
### FetchAPI
- ワンショットのクライアント起点のHTTPリクエストが再設計されたもの
### Server-Sent Events
- サーバーからクライアント側への通信を規格化したもの
### WebSocket
- 双方向通信するもの
- ボディのみを送っているようなもの
### WebRTC
- ブラウザとブラウザのP2P通信でも使う
    - テレビ電話など
- UDPをメインで使う
- NATを超えてプライベートアドレスだけで通信できるような技術も使われている
### WebRTCのユースケース（1）
#### シンプルなビデオ通話システム
- ２人でビデオ会議を行うシステム
- 主にUDPを使う
#### ファイアウォール越しのビデオ通話
#### グローバルなネットワークでのビデオ通話
- STUN、TURNなどNATの壁を超えるための仕組みも必要になるかも
- TURN STUNなど
    - https://qiita.com/okyk/items/a405f827e23cb9ef3bde
#### エンタープライズ環境でのビデオ通話
- 内部／外部ネットワークをまたぐTURNサーバーを設置する
#### スクリーン共有
#### ファイル交換
#### ホッケーゲームビューア
#### 複数人でのビデオ会議
#### 複数人でのボイスチャット付きのオンラインゲーム

### WebRTCのユースケース（2）
- P2P以外のユースケース
    - MCU
        - サーバー側で各クライアントの映像を合成して配信する
        - サーバー負荷が極めて高い
    - SFU
        - サーバーが各クライアントの映像を中継するハブ型のネットワークを構成する
        - 優勢
#### カスタマーセンター
#### IP電話端末
#### 中央サーバーを使ったビデオ会議システム
- P2Pだと多対多になるとセッション数が一気に増える
- 中央サーバー経由だと送信先は減る
### RFC以外のユースケース
- １対多のリアルタイム映像配信
    - リアルタイム性が高い
        - http 10~30s
        - webrtc ~10s
- p2pのCDN
- ゲーム
### RTCPeerConnection
- Peer-to-Peer(P2P)の通信 → ブラウザとブラウザの間で直接通信する
- UDP/IPを使用 → TCP/IPのようにパケットの到着は保障しないが、オーバーヘッドが少ない
- PeerとPeerの間で暗号化通信を行う → P2P通信の前に鍵の交換を行う
#### SDP
- P2Pのネゴシエーション時に互いのIPアドレスとポート、双方で利用できるオーディオや動画のコーデック情報を共有するためのもの
#### ICE
- NATを超えてP2P通信の接続を確立する手法
- STUN, TURNどちらかのサーバーを利用する

### メディアチャンネルとgetUserMedia
#### navigator.mediaDevices.getUserMedia()
- ウェブカメラ、オーディオデバイスの設定と取得を行うブラウザAPI
#### DTLS
- D:データグラム TLS
    - データグラムはUDP
    - 暗号化したUDPということ
- 遅くならないというニーズを実現するためのもの
